<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>HM Desk Business - ADM PANEL</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="HM ADM">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3001/3001764.png">
    <meta name="theme-color" content="#7b2cff">
    <link rel="manifest" id="pwa-manifest">

    <style>
        :root {
            --roxo: #7b2cff; --roxo-escuro: #5b12cc; --success: #28a745;
            --bg: #f8f9fd; --card: #ffffff; --text: #2d3436; --border: #edf2f7;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Segoe UI', Roboto, sans-serif; }
        body { margin: 0; background: var(--bg); color: var(--text); padding-bottom: 80px; }

        /* HEADER & ALERT */
        header { background: #fff; padding: 15px; text-align: center; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; }
        header h1 { font-size: 18px; margin: 0; color: var(--roxo); font-weight: 900; letter-spacing: 1px; }
        .alerta-adm { background: #fff9db; color: #856404; padding: 10px; margin: 10px 15px; border-radius: 10px; font-size: 12px; text-align: center; font-weight: 600; border: 1px solid #ffeeba; }

        .container { max-width: 600px; margin: 0 auto; padding: 0 15px; }

        /* ABA LAN√áAR (NOVO) */
        .form-card { background: var(--card); padding: 20px; border-radius: 18px; border: 1px solid var(--border); margin-top: 10px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 11px; font-weight: 800; color: #a0a0a0; margin-bottom: 6px; text-transform: uppercase; }
        input { width: 100%; padding: 12px; border-radius: 12px; border: 1.5px solid var(--border); background: #fbfbfb; font-size: 15px; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--roxo); background: #fff; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .btn-principal { width: 100%; background: var(--roxo); color: #fff; border: none; padding: 16px; border-radius: 14px; font-size: 15px; font-weight: 700; cursor: pointer; margin-top: 10px; box-shadow: 0 6px 15px rgba(123,44,255,0.2); }

        /* RESUMO CARD (ESTILO ORIGINAL) */
        .resumo-card {
            background: linear-gradient(135deg, var(--roxo), var(--roxo-escuro));
            color: #fff; padding: 25px; border-radius: 22px; margin: 15px 0;
            text-align: center; box-shadow: 0 10px 25px rgba(123,44,255,0.2);
        }
        .resumo-card span { font-size: 12px; text-transform: uppercase; opacity: 0.9; font-weight: 600; }
        .resumo-card h2 { font-size: 32px; margin: 5px 0 0; font-weight: 800; }

        /* FILTROS (ESTILO ORIGINAL) */
        .filtros-scroll { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 15px; margin-bottom: 5px; scrollbar-width: none; }
        .filtros-scroll::-webkit-scrollbar { display: none; }
        .btn-filtro { padding: 10px 22px; border-radius: 25px; border: 1px solid var(--border); background: #fff; font-size: 13px; font-weight: 700; white-space: nowrap; color: #777; cursor: pointer; }
        .btn-filtro.active { background: var(--roxo); color: #fff; border-color: var(--roxo); }

        /* CARDS DE REGISTRO */
        .card-item { background: #fff; border-radius: 18px; padding: 18px; margin-bottom: 12px; border: 1px solid var(--border); }
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
        .card-title b { display: block; font-size: 15px; color: #1e272e; }
        .card-title span { font-size: 12px; color: #95a5a6; }
        .status-tag { padding: 5px 10px; border-radius: 8px; font-size: 10px; font-weight: 800; text-transform: uppercase; }
        .pago { background: #e8f5e9; color: #2e7d32; }
        .pendente { background: #fff3e0; color: #ef6c00; }

        .card-body { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; border-top: 1px solid #f8f9fa; padding-top: 12px; }
        .info-label { font-size: 10px; color: #b2bec3; text-transform: uppercase; font-weight: 700; }
        .info-value { display: block; font-size: 13px; color: #2d3436; font-weight: 700; margin-top: 2px; }

        /* BOT√ïES DE ADM NO CARD */
        .card-actions { display: flex; gap: 8px; margin-top: 15px; border-top: 1px solid #f8f9fa; padding-top: 12px; }
        .btn-action { flex: 1; padding: 10px; border-radius: 10px; border: 1px solid var(--border); background: #fbfbfb; font-size: 11px; font-weight: 700; cursor: pointer; color: #636e72; }
        .btn-edit { color: var(--roxo); }
        .btn-del { color: #d63031; }

        /* NAV BOTTOM */
        .nav-bottom { position: fixed; bottom: 0; left: 0; width: 100%; background: #fff; border-top: 1px solid var(--border); display: flex; justify-content: space-around; padding: 12px 0; z-index: 100; }
        .nav-item { text-align: center; color: #b2bec3; text-decoration: none; font-size: 10px; font-weight: 800; flex: 1; }
        .nav-item.active { color: var(--roxo); }
        .nav-icon { font-size: 20px; display: block; margin-bottom: 4px; }

        /* CALENDARIO POPUP */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); display: none; justify-content: center; align-items: center; z-index: 1000; padding: 20px; }
        .modal-content { background: #fff; border-radius: 20px; width: 100%; max-width: 350px; padding: 20px; }

        .hidden { display: none; }
    </style>
</head>
<body>

<header><h1>HM DESK BUSINESS</h1></header>
<div class="alerta-adm">üõ°Ô∏è MODO ADMINISTRADOR ATIVO</div>

<div class="container">
    <div id="abaLancar">
        <div class="form-card">
            <div class="form-group">
                <label>Ve√≠culo / Descri√ß√£o</label>
                <input type="text" id="in-carro" placeholder="Ex: Corolla XEI">
            </div>
            <div class="grid-2">
                <div class="form-group">
                    <label>Placa</label>
                    <input type="text" id="in-placa" placeholder="ABC-1234">
                </div>
                <div class="form-group">
                    <label>Fornecedor</label>
                    <input type="text" id="in-fornecedor" placeholder="Nome">
                </div>
            </div>
            <div class="grid-2">
                <div class="form-group">
                    <label>Data Entrada</label>
                    <input type="date" id="in-entrada">
                </div>
                <div class="form-group">
                    <label>Data Sa√≠da</label>
                    <input type="date" id="in-saida">
                </div>
            </div>
            <div class="grid-2">
                <div class="form-group">
                    <label>Valor Compra (R$)</label>
                    <input type="number" id="in-compra" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label>Valor Venda (R$)</label>
                    <input type="number" id="in-venda" placeholder="0.00">
                </div>
            </div>
            <input type="hidden" id="edit-index" value="-1">
            <button class="btn-principal" onclick="salvarRegistro()" id="btn-main">Salvar Registro</button>
            <button class="btn-principal hidden" id="btn-cancel" style="background:#636e72; margin-top:5px;" onclick="cancelarEdicao()">Cancelar Edi√ß√£o</button>
        </div>
    </div>

    <div id="abaRegistros" class="hidden">
        <div class="resumo-card">
            <span>Margem Total Acumulada</span>
            <h2 id="resumo-margem">R$ 0,00</h2>
        </div>

        <div class="filtros-scroll">
            <button class="btn-filtro active" onclick="setFiltro('todos', this)">Todos</button>
            <button class="btn-filtro" onclick="setFiltro('hoje', this)">Hoje</button>
            <button class="btn-filtro" onclick="setFiltro('mes', this)">Este M√™s</button>
            <button class="btn-filtro" onclick="abrirCalendario()">üìÖ Per√≠odo</button>
        </div>

        <div id="lista-registros"></div>
    </div>
</div>

<nav class="nav-bottom">
    <a href="javascript:void(0)" class="nav-item active" onclick="mudarAba('lancar', this)">
        <span class="nav-icon">‚ûï</span>LAN√áAR
    </a>
    <a href="javascript:void(0)" class="nav-item" onclick="mudarAba('registros', this)">
        <span class="nav-icon">üìã</span>REGISTROS
    </a>
</nav>

<script>
    const DB_KEY = "hm_pro_db";
    let dados = JSON.parse(localStorage.getItem(DB_KEY) || "[]");
    let filtroAtual = "todos";

    // NAVEGA√á√ÉO
    function mudarAba(aba, el) {
        document.getElementById('abaLancar').classList.toggle('hidden', aba !== 'lancar');
        document.getElementById('abaRegistros').classList.toggle('hidden', aba !== 'registros');
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        el.classList.add('active');
        if(aba === 'registros') renderizar();
    }

    // SALVAR / EDITAR
    function salvarRegistro() {
        const index = parseInt(document.getElementById('edit-index').value);
        const compra = parseFloat(document.getElementById('in-compra').value) || 0;
        const venda = parseFloat(document.getElementById('in-venda').value) || 0;
        
        // Mantendo a l√≥gica de margem de 40% sobre o lucro bruto
        const lucroBruto = venda - compra;
        const margemCalculada = lucroBruto * 0.4;

        const registro = {
            carro: document.getElementById('in-carro').value,
            placa: document.getElementById('in-placa').value,
            fornecedor: document.getElementById('in-fornecedor').value,
            dataEntrada: document.getElementById('in-entrada').value,
            dataSaida: document.getElementById('in-saida').value,
            valorCompra: compra,
            valorVenda: venda,
            margem: margemCalculada,
            pago: index >= 0 ? dados[index].pago : false
        };

        if(!registro.carro) return alert("Preencha ao menos o ve√≠culo");

        if(index >= 0) {
            dados[index] = registro;
        } else {
            dados.push(registro);
        }

        localStorage.setItem(DB_KEY, JSON.stringify(dados));
        alert("Salvo com sucesso!");
        limparCampos();
        mudarAba('registros', document.querySelectorAll('.nav-item')[1]);
    }

    // RENDERIZAR LISTA
    function renderizar() {
        const lista = document.getElementById('lista-registros');
        lista.innerHTML = "";
        let totalMargem = 0;

        const hoje = new Date().toISOString().split('T')[0];

        const filtrados = dados.filter(r => {
            if(filtroAtual === 'hoje') return r.dataEntrada === hoje;
            if(filtroAtual === 'mes') return r.dataEntrada.substring(0,7) === hoje.substring(0,7);
            return true;
        }).reverse();

        filtrados.forEach((r) => {
            totalMargem += r.margem;
            const originalIndex = dados.indexOf(r);
            const card = document.createElement('div');
            card.className = 'card-item';
            card.innerHTML = `
                <div class="card-header">
                    <div class="card-title">
                        <b>${r.carro}</b>
                        <span>${r.placa || 'Sem Placa'} ‚Ä¢ ${fmtData(r.dataEntrada)}</span>
                    </div>
                    <span class="status-tag ${r.pago ? 'pago' : 'pendente'}" onclick="toggleStatus(${originalIndex})">
                        ${r.pago ? 'Pago' : 'Pendente'}
                    </span>
                </div>
                <div class="card-body">
                    <div><span class="info-label">Fornecedor</span><b class="info-value">${r.fornecedor || '-'}</b></div>
                    <div><span class="info-label">Venda</span><b class="info-value">R$ ${r.valorVenda.toLocaleString()}</b></div>
                    <div style="color:var(--success)"><span class="info-label">Margem</span><b class="info-value">R$ ${r.margem.toLocaleString()}</b></div>
                </div>
                <div class="card-actions">
                    <button class="btn-action btn-edit" onclick="iniciarEdicao(${originalIndex})">EDITAR</button>
                    <button class="btn-action btn-del" onclick="excluirRegistro(${originalIndex})">EXCLUIR</button>
                </div>
            `;
            lista.appendChild(card);
        });

        document.getElementById('resumo-margem').innerText = "R$ " + totalMargem.toLocaleString('pt-BR', {minimumFractionDigits:2});
    }

    // FUN√á√ïES DE ADM
    function toggleStatus(i) {
        dados[i].pago = !dados[i].pago;
        localStorage.setItem(DB_KEY, JSON.stringify(dados));
        renderizar();
    }

    function excluirRegistro(i) {
        if(confirm("Deseja realmente excluir este registro?")) {
            dados.splice(i, 1);
            localStorage.setItem(DB_KEY, JSON.stringify(dados));
            renderizar();
        }
    }

    function iniciarEdicao(i) {
        const r = dados[i];
        document.getElementById('in-carro').value = r.carro;
        document.getElementById('in-placa').value = r.placa;
        document.getElementById('in-fornecedor').value = r.fornecedor;
        document.getElementById('in-entrada').value = r.dataEntrada;
        document.getElementById('in-saida').value = r.dataSaida;
        document.getElementById('in-compra').value = r.valorCompra;
        document.getElementById('in-venda').value = r.valorVenda;
        document.getElementById('edit-index').value = i;
        
        document.getElementById('btn-main').innerText = "Atualizar Registro";
        document.getElementById('btn-cancel').classList.remove('hidden');
        mudarAba('lancar', document.querySelectorAll('.nav-item')[0]);
    }

    function cancelarEdicao() {
        limparCampos();
        mudarAba('registros', document.querySelectorAll('.nav-item')[1]);
    }

    function limparCampos() {
        document.querySelectorAll('input').forEach(i => i.value = "");
        document.getElementById('edit-index').value = "-1";
        document.getElementById('btn-main').innerText = "Salvar Registro";
        document.getElementById('btn-cancel').classList.add('hidden');
    }

    function setFiltro(f, btn) {
        filtroAtual = f;
        document.querySelectorAll('.btn-filtro').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderizar();
    }

    function fmtData(d) { return d ? d.split('-').reverse().join('/') : '-'; }

    // PWA SETUP (MANIFESTO DINAMICO)
    const manifest = {
        "name": "HM DESK BUSINESS ADM",
        "short_name": "HM ADM",
        "display": "standalone",
        "start_url": ".",
        "theme_color": "#7b2cff",
        "background_color": "#ffffff",
        "icons": [{"src": "https://cdn-icons-png.flaticon.com/512/3001/3001764.png", "sizes": "512x512", "type": "image/png"}]
    };
    const blob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
    document.querySelector('#pwa-manifest').setAttribute('href', URL.createObjectURL(blob));

    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register(URL.createObjectURL(new Blob(["self.addEventListener('fetch', function(event) { event.respondWith(fetch(event.request)); });"], {type: 'text/javascript'})));
    }
</script>

</body>
</html>